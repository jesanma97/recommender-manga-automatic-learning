mangas = [
    {"sinopsis": """Aoyagi Ritsuka is one troubled 6th grader. Two years ago, he mysteriously lost his memory and developed an alternate personality. His mother constantly berates (and occasionally beats) him, asking what happened to the "real" Ritsuka, and his only defender and friend, his older brother Seimei, was recently killed.<br><br>
Suddenly, Seimei's apparent "friend," Soubi, appears. Soubi tells him that Ritsuka's true name is "Loveless," and that Soubi was assigned by Seimei to take care of Ritsuka and protect him. Ritsuka soon gets sucked into a bizzare underground society where teams of people, a "Fighter Unit," and a "Sacrifice," battle using elaborate and beautifully-phrased spells.<br><br>
He seeks both acceptance of himself, and the answer to the mystery of who killed his brother and why.<br><br>
(Source: Tokyopop)""", "cluster": 1, "tags": [
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Demographic"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Theme-Other-Vehicle"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Theme-Other-Organisations"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Comedy"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Setting-Universe"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Sexual Content"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Setting-Scene"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Theme-Other-Organisations"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Other-Organisations"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Arts"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Setting-Scene"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Sci-Fi"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other-Vehicle"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Fantasy"
        }
      ]},
    {"sinopsis": "Before Naruto's birth, a great demon fox had attacked the Hidden Leaf Village. A man known as the 4th Hokage sealed the demon inside the newly born Naruto, causing him to unknowingly grow up detested by his fellow villagers. Despite his lack of talent in many areas of ninjutsu, Naruto strives for only one goal: to gain the title of Hokage, the strongest ninja in his village. Desiring the respect he never received, Naruto works towards his dream with fellow friends Sasuke and Sakura and mentor Kakashi as they go through many trials and battles that come with being a ninja.", "cluster": 1, "tags": [
        {
          "category": "Demographic"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Technical"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Fantasy"
        },
        {
          "category": "Theme-Romance"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Cast-Traits"
        }
      ]},
    {"sinopsis": "<b>When Light Yagami finds a notebook giving him power over death, will he use it for good—or evil?</b><br><br>Light Yagami is an ace student with great prospects—and he’s bored out of his mind. But all that changes when he finds the Death Note, a notebook dropped by a rogue Shinigami death god. Any human whose name is written in the notebook dies, and Light has vowed to use the power of the Death Note to rid the world of evil. But will Light succeed in his noble goal, or will the Death Note turn him into the very thing he fights against?<br><br>(Source: Viz Media)", "cluster": 3, "tags": [
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Drama"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Theme-Other-Organisations"
        },
        {
          "category": "Setting-Universe"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Action"
        },
        {
          "category": "Cast-Main Cast"
        },
        {
          "category": "Setting-Time"
        },
        {
          "category": "Demographic"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        },
        {
          "category": "Cast-Traits"
        },
        {
          "category": "Theme-Other"
        }
      ]},
    # ... 10,000 mangas más
]

# Convertimos cada manga en un string estructurado
mangas_texto = [
    f"Sinopsis: {manga['sinopsis']}. Cluster: {manga['cluster']}. Tags: {', '.join(tag['category'] for tag in manga['tags'])}."
    for manga in mangas
]

from sentence_transformers import SentenceTransformer
import numpy as np
import torch
import os

# Configurar el número de hilos para usar más núcleos de la CPU
num_threads = os.cpu_count()  # Usa el número total de núcleos disponibles
torch.set_num_threads(num_threads)

# Cargar el modelo en GPU si está disponible, de lo contrario en CPU
device = "cuda" if torch.cuda.is_available() else "cpu"
model = SentenceTransformer('all-Minilm/all-MiniLM-L6-v2', device=device)

# Generar embeddings en lotes
embeddings = model.encode(mangas_texto, batch_size=32, convert_to_numpy=True)

# Guardamos los embeddings en un archivo para futuras comparaciones
np.save("embeddings_mangas.npy", embeddings)

print(f"Generados {len(embeddings)} embeddings de dimensión {embeddings.shape[1]}")
print(embeddings[0])